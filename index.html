<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Racer</title>
    <link rel="stylesheet" href="stylesheet.css">
</head>
<body>
    <header>
        <a href="#" onclick="newRace()">Play</a>
        <a href="#">Store</a>
        <a href="#">Ship</a>
    </header>

    <div id="gameplay">
        <h3 id="winner">Game Over</h3>
        <p id="enemyShip">>,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-</p>
        <p id="playerShip">>,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-,-</p>
        <button onclick="moveShip()">Drive!</button>
        <button>NITRO</button>
        <button onclick="autogameFlick()">Auto</button>
    </div>

    <button onclick="RESET()">RESET</button>

    <p id="console">CONSOLE: </p>

</body>

<!--JAVASCRIPT-->

<script>
    //getting css vars
    let root = document.documentElement;

    //random
    function randomNum(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min) + min); // The maximum is exclusive and the minimum is inclusive
    }

    

    //new player and reset handler
    if (localStorage.getItem("newSRplayer") == "null"){
        localStorage.setItem("newSRplayer", "notNew")
    }
    function RESET(){
        localStorage.setItem("newSRplayer", null)
        localStorage.setItem("SRspeed", 1)
        localStorage.setItem("SRhandling", 1)
        localStorage.setItem("SRnitro", 1)
        localStorage.setItem("SRcyberGold", 0)
        location.reload()
    }

    //importing ids
    const enemyShip = document.querySelector("#enemyShip")
    const playerShip = document.querySelector("#playerShip")


    //init
        autoGame = false
        raceActive = false
        playerX = 0
        enemyX = 0
        enemyShipTrack = ["-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-"]
        playerShipTrack = ["-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-"]


    //new race
    function newRace(){
        raceActive = true
        playerX = 0
        enemyX = 0
        root.style.setProperty('--winnerDisplay', "none");

        document.querySelector("#console").textContent = "CONSOLE: RACING!!"

        //enemy stats(make random)
        enemyShipSpeed = randomNum(1, 5)
        enemyShipHandling = randomNum(1, 10)
    }
    
    function raceOver(){
        if (raceActive){
            root.style.setProperty('--winnerDisplay', "unset");
            raceActive = false
            if (playerX >= playerShipTrack.length - 1){
                var gamtgain = randomNum(1, 20)
                localStorage.setItem("SRcyberGold", parseInt(localStorage.getItem("SRcyberGold")) + gamtgain)
                document.querySelector("#console").textContent = ("CONSOLE: " + "You have gained " + gamtgain + " cyber gold!")
            }else{
                document.querySelector("#console").textContent = "CONSOLE: You lost :("
            }
        }
        
    }

    //autoController
    function autogameFlick(){
        if (autoGame){
            autoGame = false
            document.querySelector("#console").textContent = "CONSOLE: Auto off"
        }else if (autoGame == false){
            newRace()
            document.querySelector("#console").textContent = "CONSOLE: Auto on"
        }
    }


    //bot controller
    setInterval(shipTick, 500)
    function shipTick(){
        if (raceActive){
            if (randomNum(0, 10) <= enemyShipHandling){
                enemyX += enemyShipSpeed
            }
        }
        
    }

        //player controller
    setInterval(playerShipController, 250)
    function playerShipController(){
        if (autoGame){
            moveShip()
        }
        
    }


    //onTick
    setInterval(onTick, 1);
    function onTick(){
        if (raceActive){

            //visual systme
            enemyShipTrack = ["-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-"]
            playerShipTrack = ["-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-"]

            enemyShipTrack[enemyX] = ">"
            playerShipTrack[playerX] = ">"

            enemyShip.textContent = enemyShipTrack
            playerShip.textContent = playerShipTrack

            //end game check

        }

        if (playerX >= playerShipTrack.length - 1 || enemyX >= enemyShipTrack.length - 1){
            raceOver()
        }
    }

    function moveShip(){
        if (raceActive){
            //add stats in
            if (randomNum(0, 10) <= parseInt(localStorage.getItem("SRhandling"))){
                playerX += parseInt(localStorage.getItem("SRspeed"))
            }
        }else{
            newRace()
        }
        
    }



</script>
</html>